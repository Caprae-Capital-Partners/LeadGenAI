<!doctype html>
<html>
  <head>
    <title>Lead Form</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 50px auto;
        padding: 20px;
      }
      .form-section {
        margin-bottom: 20px;
        padding: 15px;
        background-color: #f9f9f9;
        border-radius: 5px;
      }
      .section-title {
        font-weight: bold;
        margin-bottom: 10px;
        color: #444;
        border-bottom: 1px solid #ddd;
        padding-bottom: 5px;
      }
      form {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
      }
      .full-width {
        grid-column: span 2;
      }
      label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
        color: #555;
      }
      input, textarea, select {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        box-sizing: border-box;
      }
      textarea {
        min-height: 80px;
        resize: vertical;
      }
      button {
        padding: 12px;
        background-color: #4CAF50;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
      }
      button[type="submit"] {
        grid-column: span 2;
      }
      button:hover {
        background-color: #45a049;
      }
      .view-leads {
        display: block;
        text-align: center;
        margin-top: 20px;
        color: #333;
        text-decoration: none;
      }
      .view-leads:hover {
        text-decoration: underline;
      }
      .required::after {
        content: " *";
        color: red;
      }
      .dynamic-field {
        display: flex;
        gap: 10px;
        margin-bottom: 10px;
        align-items: flex-end;
      }
      .dynamic-field select, .dynamic-field input {
        flex: 1;
      }
      .dynamic-field button {
        padding: 8px;
        margin-top: 0;
        background-color: #f44336;
      }
      .add-field-btn {
        background-color: #2196F3;
        margin-top: 5px;
      }
      #dynamic-fields-container {
        margin-top: 15px;
      }
      .field-error {
        border: 1px solid #f44336 !important;
      }
      .error-message {
        color: #f44336;
        font-size: 12px;
        margin-top: 5px;
        display: none;
      }
      .alert {
        padding: 15px;
        margin-bottom: 20px;
        border-radius: 4px;
      }
      .alert-success {
        background-color: #dff0d8;
        color: #3c763d;
        border: 1px solid #d6e9c6;
      }
      .alert-danger {
        background-color: #f2dede;
        color: #a94442;
        border: 1px solid #ebccd1;
      }
      .button-group {
        grid-column: span 2;
        display: flex;
        gap: 10px;
        margin-top: 20px;
      }
      .button-group button {
        flex: 1;
      }
    </style>
  </head>
  <body>
    <h2 class="mb-4">Submit a Lead</h2>
    
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }}">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}
    
    <form method="POST" action="{{ url_for('lead.submit') }}" id="leadForm">
      <div class="form-section full-width">
        <div class="section-title">Basic Information</div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
          <!-- Reduced to only essential fields -->
          <div>
            <label for="first_name" class="required">First Name</label>
            <input type="text" id="first_name" name="first_name" required>
          </div>
          
          <div>
            <label for="last_name" class="required">Last Name</label>
            <input type="text" id="last_name" name="last_name" required>
          </div>
          
          <div>
            <label for="email" class="required">Email</label>
            <input type="email" id="email" name="email" required>
          </div>
          
          <div>
            <label for="phone">Phone Number</label>
            <input type="text" id="phone" name="phone">
          </div>
          
          <div>
            <label for="company" class="required">Company Name</label>
            <input type="text" id="company" name="company" required>
          </div>
          
          <div>
            <label for="business_type">Business Type</label>
            <select id="business_type" name="business_type">
              <option value="">Select Type</option>
              <option value="B2B">B2B</option>
              <option value="B2C">B2C</option>
              <option value="B2B2C">B2B2C</option>
            </select>
          </div>
        </div>
      </div>
      
      <div class="form-section full-width">
        <div class="section-title">Additional Fields</div>
        <div id="dynamic-fields-container">
          <!-- Dynamic fields will be added here -->
        </div>
        <button type="button" id="add-field-btn" class="add-field-btn">+ Add Column</button>
        <div class="error-message" id="dynamic-fields-error">Please fill in all added fields or remove empty ones</div>
      </div>
      
      <div class="button-group">
        <button type="submit" id="submitBtn" class="btn btn-primary">Submit Lead</button>
        <a href="{{ url_for('lead.upload_page') }}" class="btn btn-outline-primary">Upload CSV</a>
        <a href="{{ url_for('lead.view_leads') }}" class="btn btn-secondary">View Leads</a>
      </div>
    </form>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const addFieldBtn = document.getElementById('add-field-btn');
        const dynamicFieldsContainer = document.getElementById('dynamic-fields-container');
        const leadForm = document.getElementById('leadForm');
        const dynamicFieldsError = document.getElementById('dynamic-fields-error');
        
        // Available database fields with placeholder values
        const availableFields = [
          {name: 'title', label: 'Title', placeholder: 'Ex: CEO, CTO, Marketing Director'},
          {name: 'city', label: 'City', placeholder: 'Ex: San Francisco'},
          {name: 'state', label: 'State', placeholder: 'Ex: California'},
          {name: 'website', label: 'Website', placeholder: 'Ex: https://company.com'},
          {name: 'industry', label: 'Industry', placeholder: 'Ex: Technology, Healthcare, Finance'},
          {name: 'linkedin_url', label: 'LinkedIn URL', placeholder: 'Ex: https://linkedin.com/company/name'},
          {name: 'revenue', label: 'Revenue', placeholder: 'Ex: $1M-$5M'},
          {name: 'product_service_category', label: 'Product/Service Category', placeholder: 'Ex: SaaS, Consulting, Manufacturing'},
          {name: 'associated_members', label: 'Associated Members', placeholder: 'Ex: John Doe, Jane Smith'},
          {name: 'employees_range', label: 'Employees Range', placeholder: 'Ex: 10-50, 50-200, 200-500'},
          {name: 'rev_source', label: 'Revenue Source', placeholder: 'Ex: Subscriptions, Product Sales'},
          {name: 'year_founded', label: 'Year Founded', placeholder: 'Ex: 2015'},
          {name: 'owner_linkedin', label: 'Owner LinkedIn', placeholder: 'Ex: https://linkedin.com/in/ownername'},
          {name: 'owner_age', label: 'Owner Age', placeholder: 'Ex: 35-45'},
          {name: 'additional_notes', label: 'Notes', placeholder: 'Add any additional information here'},
          {name: 'score', label: 'Score', placeholder: 'Ex: A, B, C or numerical rating'},
          {name: 'reasoning', label: 'Reasoning', placeholder: 'Explanation for the score or rating'},
          {name: 'email_customization_1', label: 'Email Customization 1', placeholder: 'Personalized email content for first outreach'},
          {name: 'subject_line_1', label: 'Subject Line 1', placeholder: 'Ex: Partnership Opportunity with [Company]'},
          {name: 'email_customization_2', label: 'Email Customization 2', placeholder: 'Personalized email content for follow-up'},
          {name: 'subject_line_2', label: 'Subject Line 2', placeholder: 'Ex: Following up on our previous conversation'},
          {name: 'linkedin_customization_1', label: 'LinkedIn Message 1', placeholder: 'Personalized LinkedIn message for first contact'},
          {name: 'linkedin_customization_2', label: 'LinkedIn Message 2', placeholder: 'Personalized LinkedIn message for follow-up'}
        ];
        
        // Form validation function
        leadForm.addEventListener('submit', function(e) {
          let isValid = true;
          const dynamicSelects = document.querySelectorAll('#dynamic-fields-container select');
          const dynamicInputs = document.querySelectorAll('#dynamic-fields-container input, #dynamic-fields-container textarea');
          
          // Reset validation styles
          dynamicSelects.forEach(select => {
            select.classList.remove('field-error');
          });
          
          dynamicInputs.forEach(input => {
            input.classList.remove('field-error');
          });
          
          dynamicFieldsError.style.display = 'none';
          
          // If there are dynamic fields, validate them
          if (dynamicSelects.length > 0) {
            dynamicSelects.forEach((select, index) => {
              if (!select.value) {
                select.classList.add('field-error');
                isValid = false;
              }
              
              // Check corresponding input/textarea
              if (index < dynamicInputs.length && !dynamicInputs[index].value) {
                dynamicInputs[index].classList.add('field-error');
                isValid = false;
              }
            });
            
            if (!isValid) {
              dynamicFieldsError.style.display = 'block';
              e.preventDefault();
            }
          }
        });
        
        // Function to create a new field row
        function addNewField() {
          const fieldContainer = document.createElement('div');
          fieldContainer.className = 'dynamic-field';
          
          // Create select for field type
          const fieldSelect = document.createElement('select');
          fieldSelect.name = 'dynamic_field_name[]';
          fieldSelect.required = true;
          
          // Add options from available fields
          const defaultOption = document.createElement('option');
          defaultOption.value = '';
          defaultOption.text = 'Select Field';
          fieldSelect.appendChild(defaultOption);
          
          availableFields.forEach(field => {
            const option = document.createElement('option');
            option.value = field.name;
            option.text = field.label;
            option.dataset.placeholder = field.placeholder;
            fieldSelect.appendChild(option);
          });
          
          // Create input for field value
          const fieldInput = document.createElement('input');
          fieldInput.type = 'text';
          fieldInput.name = 'dynamic_field_value[]';
          fieldInput.placeholder = 'Select a field type';
          fieldInput.required = true;
          
          // Update placeholder when field type changes
          fieldSelect.addEventListener('change', function() {
            const selectedOption = this.options[this.selectedIndex];
            if (selectedOption.dataset.placeholder) {
              fieldInput.placeholder = selectedOption.dataset.placeholder;
            } else {
              fieldInput.placeholder = 'Enter value';
            }
            
            // Change to textarea for longer text fields
            if (['additional_notes', 'reasoning', 'email_customization_1', 'email_customization_2', 
                 'linkedin_customization_1', 'linkedin_customization_2'].includes(this.value)) {
              const textarea = document.createElement('textarea');
              textarea.name = fieldInput.name;
              textarea.placeholder = fieldInput.placeholder;
              textarea.required = true;
              fieldInput.parentNode.replaceChild(textarea, fieldInput);
              fieldInput = textarea;
            } else if (fieldInput.tagName === 'TEXTAREA') {
              const input = document.createElement('input');
              input.type = 'text';
              input.name = fieldInput.name;
              input.placeholder = fieldInput.placeholder;
              input.required = true;
              fieldInput.parentNode.replaceChild(input, fieldInput);
              fieldInput = input;
            }
          });
          
          // Create remove button
          const removeBtn = document.createElement('button');
          removeBtn.type = 'button';
          removeBtn.innerHTML = 'âœ•';
          removeBtn.title = 'Remove field';
          removeBtn.addEventListener('click', function() {
            dynamicFieldsContainer.removeChild(fieldContainer);
          });
          
          // Add all elements to the container
          fieldContainer.appendChild(fieldSelect);
          fieldContainer.appendChild(fieldInput);
          fieldContainer.appendChild(removeBtn);
          
          // Add the container to the form
          dynamicFieldsContainer.appendChild(fieldContainer);
        }
        
        // Add event listener to the add button
        addFieldBtn.addEventListener('click', addNewField);
      });
    </script>
  </body>
</html> 