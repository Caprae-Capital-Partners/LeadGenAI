{% extends "base.html" %}
{% block title %}Lead Data{% endblock %}
{% block additional_styles %}
<style>
    :root {
      --primary-color: #4361ee;
      --secondary-color: #3f37c9;
      --accent-color: #4cc9f0;
      --success-color: #4ad66d;
      --danger-color: #f72585;
      --light-color: #f8f9fa;
      --dark-color: #212529;
      --border-color: #e9ecef;
      --hover-color: #f8f9fa;
      --background-color: #F7F9FC;
      --card-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      margin: 0;
      padding: 0;
      background: var(--background-color);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
    .container {
      flex: 1;
      max-width: 100%;
      margin: 0;
      padding: 20px;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }
    
    h1 {
      color: var(--dark-color);
      margin: 0 0 25px 0;
      font-size: 24px;
      font-weight: 600;
      position: relative;
      padding-bottom: 10px;
    }
    
    h1::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 40px;
      height: 3px;
      background: var(--primary-color);
      border-radius: 2px;
    }
    
    .filters-container {
      background: white;
      border-radius: 16px;
      box-shadow: var(--card-shadow);
      margin-bottom: 16px;
      padding: 24px;
      transition: all 0.3s ease;
    }
    
    .search-wrapper {
      width: 100%;
      max-width: 800px;
      margin: 0 auto 24px;
      position: relative;
    }
    
    .search-box {
      width: 100%;
      padding: 12px 18px 12px 45px;
      border: 1px solid #E2E8F0;
      border-radius: 12px;
      font-size: 15px;
      transition: all 0.3s ease;
      background-color: white;
    }
    
    .search-box:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
    }
    
    .search-icon {
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: #94A3B8;
    }
    
    .search-options {
      display: flex;
      gap: 15px;
      align-items: center;
      padding: 8px 0;
    }
    
    .search-option {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s ease;
      user-select: none;
      background: var(--light-color);
    }
    
    .search-option:hover {
      background-color: #e9ecef;
    }
    
    .search-option input[type="checkbox"] {
      width: 16px;
      height: 16px;
      cursor: pointer;
    }
    
    .search-option-text {
      display: flex;
      align-items: center;
      gap: 6px;
      color: #666;
      font-size: 14px;
    }
    
    .search-option svg {
      color: #666;
    }
    
    .search-option:hover .search-option-text,
    .search-option:hover svg {
      color: var(--primary-color);
    }
    
    .filters-body {
      padding: 20px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
    }
    
    .filters-section {
      margin-bottom: 20px;
    }
    
    .section-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--primary-color);
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .filters-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
      width: 100%;
    }
    
    .filter-item {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .filter-label {
      font-size: 13px;
      color: #64748B;
      font-weight: 500;
    }
    
    .filter-select {
      padding: 10px 15px;
      border: 1px solid #E2E8F0;
      border-radius: 12px;
      font-size: 14px;
      color: #1E293B;
      background-color: white;
      cursor: pointer;
      transition: all 0.2s ease;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg width='12' height='8' viewBox='0 0 12 8' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1L6 6L11 1' stroke='%2364748B' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 15px center;
      padding-right: 40px;
    }
    
    .filter-select:hover {
      border-color: var(--primary-color);
    }
    
    .filter-select:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
    }
    
    .range-inputs {
      display: flex;
      gap: 10px;
      align-items: center;
    }
    
    .range-input {
      flex: 1;
      padding: 10px 15px;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      font-size: 14px;
      background-color: white;
      transition: all 0.2s ease;
    }
    
    .range-input:hover {
      border-color: var(--primary-color);
    }
    
    .range-input:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
    }
    
    .range-separator {
      color: #666;
      font-size: 14px;
      padding: 0 5px;
    }
    
    .filters-footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 24px;
      padding-top: 20px;
      border-top: 1px solid #E2E8F0;
    }
    
    .filters-footer-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .btn-delete {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      background: white;
      border: 1px solid var(--danger-color);
      border-radius: 8px;
      color: var(--danger-color);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .btn-delete:hover {
      background: var(--danger-color);
      color: white;
    }
    
    .total-counter {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      background: #f8fafc;
      border-radius: 8px;
      border: 1px solid var(--border-color);
      color: #64748B;
      font-size: 14px;
    }
    
    .total-counter strong {
      color: var(--primary-color);
    }
    
    .actions-group {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .select-all-wrapper {
      display: flex;
      align-items: center;
      padding: 8px 16px;
      background: white;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      transition: all 0.2s ease;
    }
    
    .select-all-wrapper:hover {
      border-color: var(--primary-color);
      background: #f8fafc;
    }
    
    .select-all-label {
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--dark-color);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      user-select: none;
    }
    
    .custom-checkbox {
      appearance: none;
      -webkit-appearance: none;
      width: 18px;
      height: 18px;
      border: 2px solid #e2e8f0;
      border-radius: 4px;
      background-color: white;
      cursor: pointer;
      position: relative;
      transition: all 0.2s ease;
    }
    
    .custom-checkbox:hover {
      border-color: var(--primary-color);
    }
    
    .custom-checkbox:checked {
      background-color: var(--primary-color);
      border-color: var(--primary-color);
    }
    
    .custom-checkbox:checked::after {
      content: '';
      position: absolute;
      left: 5px;
      top: 2px;
      width: 6px;
      height: 10px;
      border: solid white;
      border-width: 0 2px 2px 0;
      transform: rotate(45deg);
    }
    
    .export-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      background: var(--success-color);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .export-btn:not(:disabled) {
      background: var(--success-color);
    }
    
    .export-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      background: #94a3b8;
    }
    
    .export-btn:not(:disabled):hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(74, 214, 109, 0.2);
    }
    
    .export-btn svg {
      width: 16px;
      height: 16px;
    }
    
    .toggle-advanced {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 16px;
      background: white;
      border: 1px solid var(--primary-color);
      border-radius: 8px;
      color: var(--primary-color);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .toggle-advanced:hover {
      background: var(--primary-color);
      color: white;
    }
    
    .toggle-icon {
      transition: transform 0.2s ease;
    }
    
    .toggle-advanced[aria-expanded="true"] .toggle-icon {
      transform: rotate(180deg);
    }
    
    .advanced-filters {
      background: white;
      border-radius: 12px;
      border: 1px solid var(--border-color);
      margin-top: 20px;
      display: none;
    }
    
    .advanced-filters.show {
      display: block;
      animation: slideDown 0.3s ease-out forwards;
    }
    
    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .filter-instructions {
      margin-bottom: 20px;
      padding: 16px;
      background: #f8fafc;
      border-radius: 8px;
      border: 1px solid var(--border-color);
    }
    
    .filter-instructions p {
      margin: 0 0 10px 0;
      color: var(--dark-color);
      font-weight: 500;
      font-size: 14px;
    }
    
    .filter-instructions ol {
      margin: 0;
      padding-left: 20px;
      color: #64748B;
    }
    
    .filter-instructions li {
      margin-bottom: 8px;
      font-size: 14px;
    }
    
    .filter-row {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-bottom: 12px;
      background: white;
      padding: 16px;
      border-radius: 8px;
      border: 1px solid var(--border-color);
    }
    
    .filter-select {
      min-width: 180px;
      padding: 8px 12px;
      border: 1px solid var(--border-color);
      border-radius: 6px;
      font-size: 14px;
      color: var(--dark-color);
      background-color: white;
    }
    
    .operator-select {
      min-width: 120px;
    }
    
    .logic-select {
      min-width: 100px;
    }
    
    .filter-input {
      flex: 1;
      padding: 8px 12px;
      border: 1px solid var(--border-color);
      border-radius: 6px;
      font-size: 14px;
      color: var(--dark-color);
    }
    
    .btn-add-filter, .btn-remove-filter {
      padding: 8px;
      border: 1px solid var(--border-color);
      border-radius: 6px;
      background: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }
    
    .btn-add-filter:hover {
      background: var(--primary-color);
      border-color: var(--primary-color);
      color: white;
    }
    
    .btn-remove-filter {
      padding: 8px;
      border: 1px solid var(--border-color);
      border-radius: 6px;
      background: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
      color: var(--danger-color);
    }
    
    .btn-remove-filter:hover {
      background: var(--danger-color);
      border-color: var(--danger-color);
      color: white;
    }
    
    .advanced-filters-actions {
      display: flex;
      gap: 12px;
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid var(--border-color);
    }
    
    .btn-apply-filter, .btn-clear-filter {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 16px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .btn-apply-filter {
      background: var(--primary-color);
      color: white;
      border: none;
    }
    
    .btn-apply-filter:hover {
      background: var(--secondary-color);
    }
    
    .btn-clear-filter {
      background: white;
      color: var(--danger-color);
      border: 1px solid var(--danger-color);
    }
    
    .btn-clear-filter:hover {
      background: var(--danger-color);
      color: white;
    }
    
    .column-visibility {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
    }
    
    .column-group {
      background: var(--light-color);
      padding: 15px;
      border-radius: 8px;
      border: 1px solid var(--border-color);
    }
    
    .column-group-title {
      font-size: 13px;
      font-weight: 600;
      color: var(--primary-color);
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--border-color);
    }
    
    .column-toggle {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 0;
      cursor: pointer;
      font-size: 13px;
      color: #666;
      transition: all 0.2s ease;
    }
    
    .column-toggle:hover {
      color: var(--primary-color);
    }
    
    .column-toggle input[type="checkbox"] {
      width: 16px;
      height: 16px;
      border: 2px solid var(--border-color);
      border-radius: 4px;
      cursor: pointer;
    }
    
    @media (max-width: 768px) {
      .filters-header {
        flex-direction: column;
        align-items: stretch;
      }
      
      .search-wrapper {
        min-width: auto;
      }
      
      .search-options {
        justify-content: flex-start;
      }
      
      .filters-footer {
        flex-direction: column;
        align-items: stretch;
      }
      
      .toggle-advanced {
        text-align: center;
        justify-content: center;
      }
      
      .total-counter {
        text-align: center;
        justify-content: center;
      }
    }
    
    .table-container {
      flex: 1;
      background: white;
      border-radius: 16px;
      box-shadow: var(--card-shadow);
      overflow: auto;
      margin-bottom: 20px;
    }
    
    table {
      width: 100%;
      min-width: max-content;
      border-collapse: separate;
      border-spacing: 0;
    }
    
    thead {
      position: sticky;
      top: 0;
      z-index: 10;
      background-color: #f8f9fa;
    }
    
    th {
      background: white;
      padding: 16px;
      text-align: left;
      font-weight: 500;
      color: #64748B;
      border-bottom: 1px solid #E2E8F0;
      font-size: 13px;
      white-space: nowrap;
    }

    th.actions {
      position: sticky;
      right: 0;
      z-index: 11;
      background-color: #f8f9fa;
    }
    
    td {
      padding: 16px;
      border-bottom: 1px solid #E2E8F0;
      color: #1E293B;
      font-size: 14px;
      white-space: nowrap;
    }
    
    td.actions {
      position: sticky;
      right: 0;
      background-color: white;
      z-index: 1;
      box-shadow: -5px 0 5px rgba(255, 255, 255, 0.9);
    }
    
    tr {
      transition: all 0.3s ease;
    }
    
    tr:hover {
      background-color: #F8FAFC;
    }
    
    .section-header {
      background-color: #e7f3ff;
      color: var(--primary-color);
      font-weight: bold;
      text-align: center;
    }
    
    .actions {
      display: flex;
      gap: 12px;
      position: sticky;
      right: 0;
      background-color: #fff;
      box-shadow: -5px 0 5px rgba(255, 255, 255, 0.9);
      padding-left: 15px;
    }
    
    .sticky-col {
      position: sticky;
      left: 0;
      background-color: #fff;
      z-index: 1;
      box-shadow: 5px 0 5px rgba(255, 255, 255, 0.9);
    }
    
    .id-col {
      width: 70px;
      text-align: center;
    }
    
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    }
    
    .btn:active {
      transform: translateY(0);
    }
    
    .btn-back {
      background: var(--primary-color);
      color: white;
      border: none;
    }
    
    .btn-back:hover {
      background: var(--secondary-color);
    }
    
    .btn-edit {
      background: var(--primary-color);
      color: white;
      border: none;
    }
    
    .btn-edit:hover {
      background: var(--secondary-color);
    }
    
    .btn-delete {
      background: white;
      color: var(--danger-color);
      border: 1px solid var(--danger-color);
    }
    
    .btn-delete:hover {
      background: var(--danger-color);
      color: white;
    }
    
    .success-message {
      background-color: #e8f5e9;
      color: #2e7d32;
      padding: 15px;
      margin-bottom: 25px;
      border-radius: 8px;
      border-left: 4px solid #43a047;
      animation: fadeInDown 0.5s;
    }
    
    .truncate {
      max-width: 250px;
      overflow: hidden;
      text-overflow: ellipsis;
      transition: all 0.2s ease;
    }
    
    .truncate:hover {
      max-width: 500px;
      white-space: normal;
      background-color: #fffde7;
      z-index: 10;
      position: relative;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    
    .date-col {
      width: 180px;
    }
    
    .highlight {
      background-color: #fffde7 !important;
    }
    
    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    .pulse-animation {
      animation: pulse 2s infinite;
    }
    
    /* Responsive adjustments */
    @media screen and (max-width: 768px) {
      .search-container {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .search-box {
        width: 100%;
        margin-bottom: 15px;
      }
      
      .total {
        margin-top: 15px;
      }
      
      .container {
        padding: 16px;
      }
      
      .btn-back {
        width: 100%;
        text-align: center;
      }
    }
    .select-all-container {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-left: auto;
        background: #f8fafc;
        padding: 8px 16px;
        border-radius: 8px;
        border: 1px solid var(--border-color);
        transition: all 0.2s ease;
      }

      .select-all-container:hover {
        background: #f1f5f9;
        border-color: var(--primary-color);
      }

      .select-all-container label {
        display: flex;
        align-items: center;
        gap: 8px;
        color: var(--dark-color);
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        user-select: none;
      }

      .checkbox-wrapper {
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .custom-checkbox {
        appearance: none;
        -webkit-appearance: none;
        width: 18px;
        height: 18px;
        border: 2px solid #e2e8f0;
        border-radius: 4px;
        background-color: white;
        cursor: pointer;
        position: relative;
        transition: all 0.2s ease;
      }

      .custom-checkbox:hover {
        border-color: var(--primary-color);
        background-color: #f8fafc;
      }

      .custom-checkbox:checked {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
      }

      .custom-checkbox:checked::after {
        content: '';
        position: absolute;
        left: 5px;
        top: 2px;
        width: 6px;
        height: 10px;
        border: solid white;
        border-width: 0 2px 2px 0;
        transform: rotate(45deg);
      }

      .custom-checkbox:indeterminate {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
      }

      .custom-checkbox:indeterminate::after {
        content: '';
        position: absolute;
        left: 3px;
        top: 7px;
        width: 10px;
        height: 2px;
        background-color: white;
      }

      /* Style for the checkbox column */
      .checkbox-col {
        width: 40px;
        text-align: center;
        background-color: #f8fafc;
        position: sticky;
        left: 0;
        z-index: 2;
      }

      .checkbox-col .checkbox-wrapper {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100%;
        padding: 8px;
      }

      /* Update the select all text style */
      .select-all-text {
        display: flex;
        align-items: center;
        gap: 4px;
        color: var(--dark-color);
      }

      .select-all-text svg {
        width: 16px;
        height: 16px;
        color: var(--primary-color);
      }

      /* Update the export button style */
      .export-btn {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 8px 16px;
        background-color: var(--success-color);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .export-btn:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(74, 214, 109, 0.2);
      }

      .export-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }

      .export-btn svg {
        width: 16px;
        height: 16px;
      }

      /* Update the bottom controls container */
      .bottom-controls {
        display: flex;
        align-items: center;
        gap: 16px;
        margin-top: 24px;
        padding: 16px;
        background: white;
        border-radius: 12px;
        box-shadow: var(--card-shadow);
      }

    /* New styles for advanced filters container */
    .advanced-filters-container {
        background: white;
        border-radius: 16px;
        box-shadow: var(--card-shadow);
        margin-bottom: 25px;
        padding: 24px;
        display: none;
        transition: all 0.3s ease;
    }

    .advanced-filters-container.show {
        display: block;
        animation: slideDown 0.3s ease-out forwards;
    }

    .advanced-filters-header {
        margin-bottom: 20px;
        padding-bottom: 16px;
        border-bottom: 1px solid var(--border-color);
    }

    .filter-instructions {
        background: #f8fafc;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 24px;
        border: 1px solid var(--border-color);
    }

    .filter-instructions p {
        color: var(--dark-color);
        font-weight: 500;
        margin-bottom: 12px;
    }

    .filter-instructions ol {
        margin: 0;
        padding-left: 20px;
        color: #64748B;
    }

    .filter-instructions li {
        margin-bottom: 8px;
        font-size: 14px;
        line-height: 1.5;
    }

    .filter-group {
        margin-bottom: 24px;
    }

    .advanced-filters-actions {
        display: flex;
        gap: 12px;
        padding-top: 20px;
        border-top: 1px solid var(--border-color);
    }

    @keyframes slideDown {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Update toggle button styles */
    .toggle-advanced {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 10px 16px;
        background: white;
        border: 1px solid var(--primary-color);
        border-radius: 8px;
        color: var(--primary-color);
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .toggle-advanced:hover {
        background: var(--primary-color);
        color: white;
    }

    .toggle-advanced[aria-expanded="true"] .toggle-icon {
        transform: rotate(180deg);
    }

    .bottom-controls {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 16px;
        background: white;
        border-radius: 12px;
        box-shadow: var(--card-shadow);
        margin-top: 24px;
    }

    .bottom-controls-left {
        display: flex;
        align-items: center;
    }

    .pagination-container {
        margin: 0;
    }
    
    .pagination {
        display: flex;
        align-items: center;
        gap: 15px;
    }
    
    .rows-per-page {
        display: flex;
        align-items: center;
        gap: 8px;
        color: #64748B;
        font-size: 14px;
    }
    
    .rows-select {
        padding: 6px 12px;
        border: 1px solid var(--border-color);
        border-radius: 6px;
        background: white;
        color: var(--dark-color);
        font-size: 14px;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .rows-select:hover {
        border-color: var(--primary-color);
    }
    
    .btn-pagination {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 8px 16px;
        border: 1px solid var(--border-color);
        background: white;
        border-radius: 8px;
        color: var(--dark-color);
        font-size: 14px;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .btn-pagination:hover:not(:disabled) {
        background: var(--primary-color);
        color: white;
        border-color: var(--primary-color);
    }
    
    .btn-pagination:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }
    
    .page-info {
        color: #64748B;
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 4px;
    }
    
    .page-info span {
        color: var(--primary-color);
        font-weight: 500;
    }
</style>
{% endblock %}

{% block content %}
    <div class="container">
        <h1 class="animate__animated animate__fadeIn">Lead Data</h1>
        
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="success-message animate__animated animate__fadeInDown">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                            <polyline points="22 4 12 14.01 9 11.01"></polyline>
                        </svg>
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        
        <div class="filters-container animate__animated animate__fadeIn">
            <div class="filters-header">
                <div class="search-wrapper">
                    <svg class="search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                    <input type="text" id="searchInput" class="search-box" placeholder="Search across all fields..." onkeyup="searchTable()">
                </div>
            </div>

            <div class="filters-body">
                <div class="filters-section">
                    <div class="section-title">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M22 3H2l8 9.46V19l4 2v-8.54L22 3z"/>
                        </svg>
                        Basic Filters
                    </div>
                    <div class="filters-grid">
                        <div class="filter-item">
                            <label class="filter-label">Company</label>
                            <select id="companyFilter" class="filter-select" onchange="applyFilters()">
                                <option value="">All Companies</option>
                                {% for company in companies %}
                                    {% if company %}
                                    <option value="{{ company }}">{{ company }}</option>
                                    {% endif %}
                                {% endfor %}
                            </select>
                        </div>
                        
                        <div class="filter-item">
                            <label class="filter-label">Location</label>
                            <select id="locationFilter" class="filter-select" onchange="applyFilters()">
                                <option value="">All Locations</option>
                                {% for location in locations %}
                                    {% if location %}
                                    <option value="{{ location }}">{{ location }}</option>
                                    {% endif %}
                                {% endfor %}
                            </select>
                        </div>
                        
                        <div class="filter-item">
                            <label class="filter-label">Role/Title</label>
                            <select id="roleFilter" class="filter-select" onchange="applyFilters()">
                                <option value="">All Roles</option>
                                {% for role in roles %}
                                    {% if role %}
                                    <option value="{{ role }}">{{ role }}</option>
                                    {% endif %}
                                {% endfor %}
                            </select>
                        </div>

                        <div class="filter-item">
                            <label class="filter-label">Lead Score</label>
                            <select id="scoreFilter" class="filter-select" onchange="applyFilters()">
                                <option value="">All Scores</option>
                                {% for score in scores %}
                                    {% if score %}
                                    <option value="{{ score }}">{{ score }}</option>
                                    {% endif %}
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <div class="filters-footer">
                <div class="filters-footer-left">
                    <button class="btn btn-delete" onclick="clearAllFilters()" title="Clear all filters (basic and advanced)">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                        </svg>
                        Clear All Filters
                    </button>
                </div>

                <div class="total-counter">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                    Total: <strong id="totalCount">{{ leads|length }}</strong> leads
                </div>

                <div class="actions-group">
                    <div class="select-all-wrapper">
                        <label class="select-all-label">
                            <input type="checkbox" id="selectAll" class="custom-checkbox" onclick="toggleAllCheckboxes()">
                            Select All
                        </label>
                    </div>

                    <form id="exportForm" action="{{ url_for('lead.export_leads') }}" method="POST" style="margin: 0;">
                        <button type="submit" class="export-btn" id="exportBtn" disabled>
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="7 10 12 15 17 10"></polyline>
                                <line x1="12" y1="15" x2="12" y2="3"></line>
                            </svg>
                            <span>Export Selected (0)</span>
                        </button>
                    </form>

                    <button class="toggle-advanced" onclick="toggleAdvancedFilters()" aria-expanded="false">
                        Advanced Filters
                        <svg class="toggle-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Separate Advanced Filters Container -->
        <div class="advanced-filters-container animate__animated" id="advancedFilters">
            <div class="advanced-filters-header">
                <div class="section-title">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M22 3H2l8 9.46V19l4 2v-8.54L22 3z"/>
                    </svg>
                    Advanced Filters
                </div>
            </div>

            <div class="filter-instructions">
                <p>Build your filter by:</p>
                <ol>
                    <li>Select a field to filter</li>
                    <li>Choose an operator (equals, contains, etc.)</li>
                    <li>Enter a value</li>
                    <li>Add more conditions with + button if needed</li>
                    <li>Use AND/OR to combine conditions</li>
                </ol>
            </div>

            <div class="filter-group" id="filterGroup1">
                <div class="filter-row">
                    <select class="filter-select field-select">
                        <option value="">Select Field</option>
                        <!-- Basic Information -->
                        <option value="company">Company</option>
                        <option value="first_name">First Name</option>
                        <option value="last_name">Last Name</option>
                        <option value="email">Email</option>
                        <option value="phone">Phone</option>
                        <option value="title">Title</option>
                        <option value="city">City</option>
                        <option value="state">State</option>
                        
                        <!-- Company Details -->
                        <option value="website">Website URL</option>
                        <option value="linkedin_url">LinkedIn Profile</option>
                        <option value="industry">Industry</option>
                        <option value="revenue">Annual Revenue</option>
                        <option value="product_service_category">Products/Services</option>
                        <option value="business_type">Business Type</option>
                        <option value="employees_range">Employee Range</option>
                        <option value="rev_source">Revenue Source</option>
                        <option value="year_founded">Year Founded</option>
                        <option value="associated_members">Associated Members</option>
                        
                        <!-- Owner Information -->
                        <option value="owner_linkedin">Owner's LinkedIn</option>
                        <option value="owner_age">Owner's Age Range</option>
                        
                        <!-- Scoring and Notes -->
                        <option value="score">Lead Score</option>
                        <option value="reasoning">Score Reasoning</option>
                        <option value="additional_notes">Additional Notes</option>
                        
                        <!-- Email Customization -->
                        <option value="subject_line_1">Email Subject (1st)</option>
                        <option value="email_customization_1">Email Content (1st)</option>
                        <option value="subject_line_2">Email Subject (2nd)</option>
                        <option value="email_customization_2">Email Content (2nd)</option>
                        
                        <!-- LinkedIn Customization -->
                        <option value="linkedin_customization_1">LinkedIn Message (1st)</option>
                        <option value="linkedin_customization_2">LinkedIn Message (2nd)</option>
                        
                        <!-- Timestamps -->
                        <option value="created_at">Created Date</option>
                        <option value="updated_at">Last Updated</option>
                    </select>
                    <select class="filter-select operator-select">
                        <option value="equals">Equals</option>
                        <option value="contains">Contains</option>
                        <option value="starts">Starts with</option>
                        <option value="ends">Ends with</option>
                        <option value="greater">Greater than</option>
                        <option value="less">Less than</option>
                    </select>
                    <input type="text" class="filter-input value-input" placeholder="Enter value...">
                    <select class="filter-select logic-select">
                        <option value="AND">AND</option>
                        <option value="OR">OR</option>
                    </select>
                    <button class="btn btn-sm btn-add-filter" onclick="addFilterRow(this)" title="Add another condition">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                    </button>
                    <button class="btn btn-sm btn-remove-filter" onclick="removeFilterRow(this)" title="Remove this condition">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                    </button>
                </div>
            </div>

            <div class="advanced-filters-actions">
                <button class="btn btn-apply-filter" onclick="applyFilters()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="9 11 12 14 22 4"></polyline>
                        <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
                    </svg>
                    Apply Filters
                </button>
                <button class="btn btn-clear-filter" onclick="clearAdvancedFilters()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                    </svg>
                    Clear Advanced Filters
                </button>
            </div>
        </div>

        <!-- Separate Table Section -->
        <div class="table-wrapper">
            <div class="table-container animate__animated animate__fadeInUp">
                <table id="leadsTable">
                    <thead>
                        <tr>
                            <th class="checkbox-col">
                                <div class="checkbox-wrapper">
                                    <input type="checkbox" id="selectAll" class="custom-checkbox" onclick="toggleAllCheckboxes()">
                                </div>
                            </th>
                            <th class="sticky-col id-col">ID</th>
                            <!-- Basic Information -->
                            <th>Company</th>
                            <th>First Name</th>
                            <th>Last Name</th>
                            <th>Email </th>
                            <th>Phone Number</th>
                            <th>Title</th>
                            <th>Location</th>
                            <!-- Company Details -->
                            <th>Website URL</th>
                            <th>LinkedIn Profile</th>
                            <th>Industry Sector</th>
                            <th>Annual Revenue</th>
                            <th>Products/Services</th>
                            <th>Business Type</th>
                            <th>Employee</th>
                            <th>Established Year</th>
                            <!-- Customization -->
                            <th>Owner's LinkedIn</th>
                            <th>Owner's Age Range</th>
                            <th>Lead Score</th>
                            <th>Score Reasoning</th>
                            <th>Additional Notes</th>
                            <!-- Email 1 -->
                            <th>Email Subject (1st)</th>
                            <th>Email Content (1st)</th>
                            <!-- Email 2 -->
                            <th>Email Subject (2nd)</th>
                            <th>Email Content (2nd)</th>
                            <!-- LinkedIn -->
                            <th>LinkedIn Message (1st)</th>
                            <th>LinkedIn Message (2nd)</th>
                            <!-- Timestamps -->
                            <th class="date-col">Created Date</th>
                            <th class="date-col">Last Updated</th>
                            <!-- Actions -->
                            <th class="actions">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for lead in leads %}
                        <tr class="animate__animated animate__fadeIn" data-index="{{ loop.index }}">
                            <td class="checkbox-col">
                                <div class="checkbox-wrapper">
                                    <input type="checkbox" class="lead-checkbox custom-checkbox" value="{{ lead.id }}" onchange="updateExportButton()">
                                </div>
                            </td>
                            <td class="sticky-col id-col">{{ lead.id }}</td>
                            <!-- Basic Information -->
                            <td>{{ lead.company or '-' }}</td>
                            <td>{{ lead.first_name or '-' }}</td>
                            <td>{{ lead.last_name or '-' }}</td>
                            <td>{{ lead.email or '-' }}</td>
                            <td>{{ lead.phone or '-' }}</td>
                            <td>{{ lead.title or '-' }}</td>
                            <td>{{ (lead.city ~ ', ' ~ lead.state) if (lead.city and lead.state) else (lead.city or lead.state or '-') }}</td>
                            <!-- Company Details -->
                            <td>{{ lead.website or '-' }}</td>
                            <td>{{ lead.linkedin_url or '-' }}</td>
                            <td>{{ lead.industry or '-' }}</td>
                            <td>{{ lead.revenue or '-' }}</td>
                            <td>{{ lead.product_service_category or '-' }}</td>
                            <td>{{ lead.business_type or '-' }}</td>
                            <td>{{ lead.employees_range or '-' }}</td>
                            <td>{{ lead.year_founded or '-' }}</td>
                            <!-- Customization -->
                            <td>{{ lead.owner_linkedin or '-' }}</td>
                            <td>{{ lead.owner_age or '-' }}</td>
                            <td>{{ lead.score or '-' }}</td>
                            <td class="truncate" title="{{ lead.reasoning }}">{{ lead.reasoning or '-' }}</td>
                            <td class="truncate" title="{{ lead.additional_notes }}">{{ lead.additional_notes or '-' }}</td>
                            <!-- Email 1 -->
                            <td>{{ lead.subject_line_1 or '-' }}</td>
                            <td class="truncate" title="{{ lead.email_customization_1 }}">{{ lead.email_customization_1 or '-' }}</td>
                            <!-- Email 2 -->
                            <td>{{ lead.subject_line_2 or '-' }}</td>
                            <td class="truncate" title="{{ lead.email_customization_2 }}">{{ lead.email_customization_2 or '-' }}</td>
                            <!-- LinkedIn -->
                            <td class="truncate" title="{{ lead.linkedin_customization_1 }}">{{ lead.linkedin_customization_1 or '-' }}</td>
                            <td class="truncate" title="{{ lead.linkedin_customization_2 }}">{{ lead.linkedin_customization_2 or '-' }}</td>
                            <!-- Timestamps -->
                            <td class="date-col">{{ lead.created_at or '-' }}</td>
                            <td class="date-col">{{ lead.updated_at or '-' }}</td>
                            <!-- Actions -->
                            <td class="actions">
                                <a href="{{ url_for('lead.edit_lead', lead_id=lead.id) }}" class="btn btn-edit">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                    </svg>
                                    Edit
                                </a>
                                <a href="{{ url_for('lead.delete_lead', lead_id=lead.id) }}" class="btn btn-delete" onclick="return confirm('Are you sure you want to delete this lead?')">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <polyline points="3 6 5 6 21 6"></polyline>
                                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                        <line x1="10" y1="11" x2="10" y2="17"></line>
                                        <line x1="14" y1="11" x2="14" y2="17"></line>
                                    </svg>
                                    Delete
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <div class="bottom-controls">
            <div class="bottom-controls-left">
                <a href="{{ url_for('lead.form') }}" class="btn btn-back">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="19" y1="12" x2="5" y2="12"></line>
                        <polyline points="12 19 5 12 12 5"></polyline>
                    </svg>
                    Back to Form
                </a>
            </div>
            <div class="pagination-container">
                <div class="pagination">
                    <div class="rows-per-page">
                        <label>Rows per page:</label>
                        <select class="rows-select" onchange="changeRowsPerPage(this.value)">
                            <option value="10">10</option>
                            <option value="25">25</option>
                            <option value="50">50</option>
                            <option value="100">100</option>
                            <option value="all">All</option>
                        </select>
                    </div>
                    <button onclick="changePage(-1)" class="btn btn-pagination">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="15 18 9 12 15 6"></polyline>
                        </svg>
                        Previous
                    </button>
                    <span class="page-info">Page <span id="currentPage">1</span> of <span id="totalPages">1</span></span>
                    <button onclick="changePage(1)" class="btn btn-pagination">
                        Next
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="9 18 15 12 9 6"></polyline>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Add hover functionality for truncated content
        document.querySelectorAll('.truncate').forEach(el => {
            el.addEventListener('mouseenter', function() {
                if (this.offsetWidth < this.scrollWidth) {
                    this.title = this.textContent;
                }
            });
        });
        
        // Apply animation delays based on data-index attribute
        document.querySelectorAll('tr[data-index]').forEach(row => {
            const index = row.getAttribute('data-index');
            row.style.animationDelay = `${index * 0.03}s`;
        });
        
        function toggleAllCheckboxes() {
            const selectAllCheckbox = document.getElementById('selectAll');
            const checkboxes = document.querySelectorAll('.lead-checkbox');
            const headerCheckbox = document.querySelector('.checkbox-col .custom-checkbox');
            
            // Get all visible rows
            const visibleRows = Array.from(document.querySelectorAll('#leadsTable tbody tr')).filter(
                row => row.style.display !== 'none'
            );
            
            // Get all visible checkboxes
            const visibleCheckboxes = visibleRows.map(row => row.querySelector('.lead-checkbox'));
            
            // Set checked state for all checkboxes (both header and rows)
            const newCheckedState = selectAllCheckbox.checked;
            checkboxes.forEach(checkbox => {
                if (checkbox) checkbox.checked = newCheckedState;
            });
            
            // Sync header checkboxes
            if (headerCheckbox) headerCheckbox.checked = newCheckedState;
            if (selectAllCheckbox) selectAllCheckbox.checked = newCheckedState;
            
            // Update export button state
            updateExportButton();
        }

        // Add event listener to sync header checkbox with select all
        document.addEventListener('DOMContentLoaded', function() {
            const headerCheckbox = document.querySelector('.checkbox-col .custom-checkbox');
            const selectAllCheckbox = document.getElementById('selectAll');
            
            if (headerCheckbox) {
                headerCheckbox.addEventListener('change', function() {
                    if (selectAllCheckbox) {
                        selectAllCheckbox.checked = this.checked;
                        toggleAllCheckboxes();
                    }
                });
            }
            
            if (selectAllCheckbox) {
                selectAllCheckbox.addEventListener('change', function() {
                    if (headerCheckbox) {
                        headerCheckbox.checked = this.checked;
                        toggleAllCheckboxes();
                    }
                });
            }
        });

        function updateExportButton() {
            const selectedCheckboxes = document.querySelectorAll('.lead-checkbox:checked');
            const exportBtn = document.getElementById('exportBtn');
            const exportForm = document.getElementById('exportForm');
            
            // Remove any existing hidden inputs
            const existingInputs = exportForm.querySelectorAll('input[name="selected_leads[]"]');
            existingInputs.forEach(input => input.remove());
            
            // Add new hidden inputs for selected leads
            selectedCheckboxes.forEach(checkbox => {
                const input = document.createElement('input');
                input.type = 'hidden';
                input.name = 'selected_leads[]';
                input.value = checkbox.value;
                exportForm.appendChild(input);
            });
            
            exportBtn.disabled = selectedCheckboxes.length === 0;
            exportBtn.innerHTML = `
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7 10 12 15 17 10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                </svg>
                <span>Export Selected (${selectedCheckboxes.length})</span>
            `;
        }

        function toggleAdvancedFilters() {
            const advancedFilters = document.getElementById('advancedFilters');
            const toggleButton = document.querySelector('.toggle-advanced');
            const isExpanded = toggleButton.getAttribute('aria-expanded') === 'true';
            
            if (isExpanded) {
                advancedFilters.classList.remove('show');
                toggleButton.setAttribute('aria-expanded', 'false');
            } else {
                advancedFilters.classList.add('show', 'animate__fadeIn');
                toggleButton.setAttribute('aria-expanded', 'true');
            }
        }

        function toggleColumn(columnIndex) {
            const table = document.getElementById('leadsTable');
            const rows = table.getElementsByTagName('tr');
            
            // Toggle header and all cells in the column
            for (let i = 0; i < rows.length; i++) {
                const cells = rows[i].getElementsByTagName(i === 0 ? 'th' : 'td');
                if (cells[columnIndex]) {
                    cells[columnIndex].style.display = cells[columnIndex].style.display === 'none' ? '' : 'none';
                }
            }
        }

        function normalizeValue(value) {
            return value ? value.toString().trim().toLowerCase() : '';
        }

        function applyFilters() {
            // Get basic filter values
            const searchText = document.getElementById('searchInput').value.toLowerCase();
            const company = document.getElementById('companyFilter').value;
            const location = document.getElementById('locationFilter').value;
            const role = document.getElementById('roleFilter').value;
            const score = document.getElementById('scoreFilter').value;

            // Get advanced filter conditions
            const advancedFilters = [];
            document.querySelectorAll('.filter-row').forEach(row => {
                const field = row.querySelector('.field-select').value;
                const operator = row.querySelector('.operator-select').value;
                const value = row.querySelector('.value-input').value.trim();
                const logic = row.querySelector('.logic-select').value;

                if (field && operator && value) {
                    advancedFilters.push({ field, operator, value, logic });
                }
            });

            const table = document.getElementById('leadsTable');
            const rows = table.getElementsByTagName('tr');
            let visibleCount = 0;

            // Column mapping for advanced filters
            const columnMap = {
                'company': 2,
                'first_name': 3,
                'last_name': 4,
                'email': 5,
                'phone': 6,
                'title': 7,
                'location': 8,
                'industry': 11,
                'revenue': 12,
                'employees': 15,
                'score': 20
            };

            // Skip header row
            for (let i = 1; i < rows.length; i++) {
                const row = rows[i];
                let shouldShow = true;

                // Apply basic filters
                if (shouldShow && company) {
                    const companyCell = row.cells[2].textContent.trim().toLowerCase();
                    shouldShow = companyCell === company.toLowerCase();
                }

                if (shouldShow && location) {
                    const locationCell = row.cells[8].textContent.trim().toLowerCase();
                    shouldShow = locationCell === location.toLowerCase();
                }

                if (shouldShow && role) {
                    const roleCell = row.cells[7].textContent.trim().toLowerCase();
                    shouldShow = roleCell === role.toLowerCase();
                }

                if (shouldShow && score) {
                    const scoreCell = row.cells[20].textContent.trim().toLowerCase();
                    shouldShow = scoreCell === score.toLowerCase();
                }

                // Apply search text
                if (shouldShow && searchText) {
                    let found = false;
                    const cells = row.getElementsByTagName('td');
                    for (let cell of cells) {
                        if (cell.textContent.toLowerCase().includes(searchText)) {
                            found = true;
                            break;
                        }
                    }
                    shouldShow = found;
                }

                // Apply advanced filters
                if (shouldShow && advancedFilters.length > 0) {
                    let advancedResult = true;
                    
                    advancedFilters.forEach((filter, index) => {
                        const cellValue = row.cells[columnMap[filter.field]].textContent.trim();
                        const filterValue = filter.value;
                        let matches = false;

                        switch (filter.operator) {
                            case 'equals':
                                matches = cellValue.toLowerCase() === filterValue.toLowerCase();
                                break;
                            case 'contains':
                                matches = cellValue.toLowerCase().includes(filterValue.toLowerCase());
                                break;
                            case 'starts':
                                matches = cellValue.toLowerCase().startsWith(filterValue.toLowerCase());
                                break;
                            case 'ends':
                                matches = cellValue.toLowerCase().endsWith(filterValue.toLowerCase());
                                break;
                            case 'greater':
                                matches = parseFloat(cellValue) > parseFloat(filterValue);
                                break;
                            case 'less':
                                matches = parseFloat(cellValue) < parseFloat(filterValue);
                                break;
                        }

                        if (index === 0) {
                            advancedResult = matches;
                        } else {
                            const previousLogic = advancedFilters[index - 1].logic;
                            advancedResult = previousLogic === 'AND' ? 
                                (advancedResult && matches) : 
                                (advancedResult || matches);
                        }
                    });

                    shouldShow = advancedResult;
                }

                // Update row visibility
                row.style.display = shouldShow ? '' : 'none';
                if (shouldShow) visibleCount++;
            }

            // Update total count
            document.getElementById('totalCount').textContent = visibleCount;

            // Update select all checkbox
            const selectAllCheckbox = document.getElementById('selectAll');
            if (selectAllCheckbox) selectAllCheckbox.checked = false;

            // Update export button state
            updateExportButton();
        }

        // Remove automatic filter application on input change
        document.addEventListener('DOMContentLoaded', function() {
            // Add change event listeners to all filter dropdowns
            const filters = ['companyFilter', 'locationFilter', 'roleFilter', 'scoreFilter'];
            filters.forEach(filterId => {
                const filter = document.getElementById(filterId);
                if (filter) {
                    filter.addEventListener('change', applyFilters);
                }
            });

            // Add input event listener to search box
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', applyFilters);
            }

            // Initialize filters
            populateFilters();

            // Add change event listener to all checkboxes
            document.querySelectorAll('.lead-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const allCheckboxes = Array.from(document.querySelectorAll('.lead-checkbox'));
                    const visibleCheckboxes = allCheckboxes.filter(cb => 
                        cb.closest('tr').style.display !== 'none'
                    );
                    const allChecked = visibleCheckboxes.every(cb => cb.checked);
                    const selectAllCheckbox = document.getElementById('selectAll');
                    if (selectAllCheckbox) {
                        selectAllCheckbox.checked = allChecked;
                        selectAllCheckbox.indeterminate = !allChecked && 
                            visibleCheckboxes.some(cb => cb.checked);
                    }
                    updateExportButton();
                });
            });
        });

        function clearFilters() {
            // Reset all filter dropdowns
            const filters = ['companyFilter', 'locationFilter', 'roleFilter', 'scoreFilter'];
            filters.forEach(filterId => {
                const filter = document.getElementById(filterId);
                if (filter) {
                    filter.value = '';
                }
            });

            // Clear search input
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.value = '';
            }

            // Show all rows
            const table = document.getElementById('leadsTable');
            const rows = table.getElementsByTagName('tr');
            let totalRows = 0;
            
            for (let i = 1; i < rows.length; i++) {
                rows[i].style.display = '';
                totalRows++;
            }

            // Update total count
            document.getElementById('totalCount').textContent = totalRows;

            // Uncheck select all
            const selectAllCheckbox = document.getElementById('selectAll');
            if (selectAllCheckbox) {
                selectAllCheckbox.checked = false;
            }

            // Update export button state
            updateExportButton();
        }

        // Update the existing searchTable function to use applyFilters
        function searchTable() {
            applyFilters();
        }
        
        // Initialize search on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Add event listener for search input
            document.getElementById('searchInput').addEventListener('keyup', searchTable);
            
            // Add row highlighting on hover
            const tableRows = document.querySelectorAll('#leadsTable tbody tr');
            tableRows.forEach(row => {
                row.addEventListener('mouseenter', function() {
                    this.classList.add('highlight');
                });
                row.addEventListener('mouseleave', function() {
                    this.classList.remove('highlight');
                });
            });

            // Initialize export button state
            updateExportButton();
        });

        // Initialize tooltips
        const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        const tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });

        // Add animation class to table rows
        document.addEventListener('DOMContentLoaded', function() {
            const rows = document.querySelectorAll('table tr');
            rows.forEach((row, index) => {
                row.classList.add('animate__animated', 'animate__fadeIn');
                row.style.animationDelay = `${index * 0.05}s`;
            });
        });

        // Add sorting functionality
        function sortTable(columnIndex) {
            const table = document.getElementById('leadsTable');
            const tbody = table.getElementsByTagName('tbody')[0];
            const rows = Array.from(tbody.getElementsByTagName('tr'));
            const sortIcon = event.target;
            const isAscending = !sortIcon.classList.contains('asc');
            
            // Reset all sort icons
            document.querySelectorAll('.sort-icon').forEach(icon => {
                icon.classList.remove('asc');
            });
            
            if (isAscending) {
                sortIcon.classList.add('asc');
            }
            
            rows.sort((a, b) => {
                const aValue = a.cells[columnIndex].textContent.trim();
                const bValue = b.cells[columnIndex].textContent.trim();
                
                // Check if the values are dates
                const aDate = new Date(aValue);
                const bDate = new Date(bValue);
                if (!isNaN(aDate) && !isNaN(bDate)) {
                    return isAscending ? aDate - bDate : bDate - aDate;
                }
                
                // Check if the values are numbers
                const aNum = parseFloat(aValue);
                const bNum = parseFloat(bValue);
                if (!isNaN(aNum) && !isNaN(bNum)) {
                    return isAscending ? aNum - bNum : bNum - aNum;
                }
                
                // Sort as strings
                return isAscending ? 
                    aValue.localeCompare(bValue) : 
                    bValue.localeCompare(aValue);
            });
            
            // Reorder the rows
            rows.forEach(row => tbody.appendChild(row));
        }

        // Add sort icons to table headers
        document.addEventListener('DOMContentLoaded', function() {
            const headers = document.querySelectorAll('#leadsTable th');
            headers.forEach((header, index) => {
                // Skip checkbox column (index 0), ID column (index 1), and actions column
                if (index > 1 && !header.classList.contains('actions')) {
                    const sortIcon = document.createElement('span');
                    sortIcon.innerHTML = '';
                    sortIcon.className = 'sort-icon';
                    sortIcon.onclick = () => sortTable(index);
                    header.appendChild(sortIcon);
                }
            });
        });

        function clearAdvancedFilters() {
            // Clear all advanced filter inputs
            document.querySelectorAll('.filter-row').forEach((row, index) => {
                if (index === 0) {
                    // Reset first row to default values
                    row.querySelector('.field-select').value = '';
                    row.querySelector('.operator-select').value = 'equals';
                    row.querySelector('.value-input').value = '';
                    row.querySelector('.logic-select').value = 'AND';
                } else {
                    // Remove additional rows
                    row.remove();
                }
            });

            // Apply filters to update the table
            applyFilters();
        }

        function addFilterRow(button) {
            const filterGroup = document.getElementById('filterGroup1');
            const newRow = document.createElement('div');
            newRow.className = 'filter-row';
            newRow.innerHTML = `
                <select class="filter-select field-select">
                    <option value="">Select Field</option>
                    <!-- Basic Information -->
                    <option value="company">Company</option>
                    <option value="first_name">First Name</option>
                    <option value="last_name">Last Name</option>
                    <option value="email">Email</option>
                    <option value="phone">Phone</option>
                    <option value="title">Title</option>
                    <option value="city">City</option>
                    <option value="state">State</option>
                    
                    <!-- Company Details -->
                    <option value="website">Website URL</option>
                    <option value="linkedin_url">LinkedIn Profile</option>
                    <option value="industry">Industry</option>
                    <option value="revenue">Annual Revenue</option>
                    <option value="product_service_category">Products/Services</option>
                    <option value="business_type">Business Type</option>
                    <option value="employees_range">Employee Range</option>
                    <option value="rev_source">Revenue Source</option>
                    <option value="year_founded">Year Founded</option>
                    <option value="associated_members">Associated Members</option>
                    
                    <!-- Owner Information -->
                    <option value="owner_linkedin">Owner's LinkedIn</option>
                    <option value="owner_age">Owner's Age Range</option>
                    
                    <!-- Scoring and Notes -->
                    <option value="score">Lead Score</option>
                    <option value="reasoning">Score Reasoning</option>
                    <option value="additional_notes">Additional Notes</option>
                    
                    <!-- Email Customization -->
                    <option value="subject_line_1">Email Subject (1st)</option>
                    <option value="email_customization_1">Email Content (1st)</option>
                    <option value="subject_line_2">Email Subject (2nd)</option>
                    <option value="email_customization_2">Email Content (2nd)</option>
                    
                    <!-- LinkedIn Customization -->
                    <option value="linkedin_customization_1">LinkedIn Message (1st)</option>
                    <option value="linkedin_customization_2">LinkedIn Message (2nd)</option>
                    
                    <!-- Timestamps -->
                    <option value="created_at">Created Date</option>
                    <option value="updated_at">Last Updated</option>
                </select>
                <select class="filter-select operator-select">
                    <option value="equals">Equals</option>
                    <option value="contains">Contains</option>
                    <option value="starts">Starts with</option>
                    <option value="ends">Ends with</option>
                    <option value="greater">Greater than</option>
                    <option value="less">Less than</option>
                </select>
                <input type="text" class="filter-input value-input" placeholder="Enter value...">
                <select class="filter-select logic-select">
                    <option value="AND">AND</option>
                    <option value="OR">OR</option>
                </select>
                <button class="btn btn-sm btn-add-filter" onclick="addFilterRow(this)" title="Add another condition">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                </button>
                <button class="btn btn-sm btn-remove-filter" onclick="removeFilterRow(this)" title="Remove this condition">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                </button>
            `;
            filterGroup.appendChild(newRow);
        }

        function removeFilterRow(button) {
            const row = button.closest('.filter-row');
            const filterGroup = row.parentElement;
            
            // Only remove if there's more than one row
            if (filterGroup.children.length > 1) {
                row.remove();
            } else {
                // If it's the last row, just clear the values
                row.querySelector('.field-select').value = '';
                row.querySelector('.operator-select').value = 'equals';
                row.querySelector('.value-input').value = '';
                row.querySelector('.logic-select').value = 'AND';
            }
        }

        // Pagination functionality
        let rowsPerPage = 10; 
        let currentPage = 1;

        function setupPagination() {
            const table = document.getElementById('leadsTable');
            const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');
            const totalPages = Math.ceil(rows.length / rowsPerPage);
            
            // Update total pages in existing pagination
            document.getElementById('totalPages').textContent = totalPages;
            
            // Show initial page
            showPage(currentPage);
        }

        function changeRowsPerPage(value) {
            rowsPerPage = value === 'all' ? 'all' : parseInt(value);
            currentPage = 1; // Reset to first page
            const table = document.getElementById('leadsTable');
            const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');
            const totalPages = rowsPerPage === 'all' ? 1 : Math.ceil(rows.length / rowsPerPage);
            
            // Update total pages display
            document.getElementById('totalPages').textContent = totalPages;
            
            // Show first page with new rows per page setting
            showPage(1);
        }

        function showPage(page) {
            const table = document.getElementById('leadsTable');
            const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');
            const totalPages = rowsPerPage === 'all' ? 1 : Math.ceil(rows.length / rowsPerPage);
            
            // Validate page number
            if (page < 1) page = 1;
            if (page > totalPages) page = totalPages;
            
            currentPage = page;
            
            // Update page info
            document.getElementById('currentPage').textContent = currentPage;
            
            // Show/hide rows for current page
            for (let i = 0; i < rows.length; i++) {
                if (rowsPerPage === 'all') {
                    rows[i].style.display = '';
                } else if (i >= (page - 1) * rowsPerPage && i < page * rowsPerPage) {
                    rows[i].style.display = '';
                } else {
                    rows[i].style.display = 'none';
                }
            }
            
            // Update button states
            const prevButton = document.querySelector('.btn-pagination:first-child');
            const nextButton = document.querySelector('.btn-pagination:last-child');
            prevButton.disabled = page === 1;
            nextButton.disabled = page === totalPages;

            // Update total count display
            const visibleRows = rowsPerPage === 'all' ? rows.length : 
                              Math.min(rowsPerPage, rows.length - (currentPage - 1) * rowsPerPage);
            const totalRows = rows.length;
            document.getElementById('rowsInfo').textContent = 
                `Showing ${(currentPage - 1) * rowsPerPage + 1} to ${(currentPage - 1) * rowsPerPage + visibleRows} of ${totalRows} entries`;
        }

        function changePage(direction) {
            showPage(currentPage + direction);
        }

        // Add pagination styles
        const style = document.createElement('style');
        style.textContent = `
            .pagination-container {
                margin-top: 20px;
                margin-bottom: 20px;
            }
            
            .pagination {
                display: flex;
                justify-content: center;
                align-items: center;
                gap: 15px;
            }
            
            .btn-pagination {
                padding: 8px 16px;
                border: 1px solid var(--border-color);
                background: white;
                border-radius: 8px;
                cursor: pointer;
                transition: all 0.2s ease;
            }
            
            .btn-pagination:hover:not(:disabled) {
                background: var(--primary-color);
                color: white;
                border-color: var(--primary-color);
            }
            
            .btn-pagination:disabled {
                opacity: 0.5;
                cursor: not-allowed;
            }
            
            .page-info {
                color: var(--dark-color);
                font-size: 14px;
            }
        `;
        document.head.appendChild(style);

        // Initialize pagination when document loads
        document.addEventListener('DOMContentLoaded', function() {
            setupPagination();
            // ... existing DOMContentLoaded code ...
        });

        function clearAllFilters() {
            // Reset all basic filter dropdowns
            document.getElementById('companyFilter').value = '';
            document.getElementById('locationFilter').value = '';
            document.getElementById('roleFilter').value = '';
            document.getElementById('scoreFilter').value = '';
            
            // Clear search input
            document.getElementById('searchInput').value = '';
            
            // Clear advanced filters
            const advancedFilters = document.getElementById('advancedFilters');
            if (advancedFilters) {
                // Reset all filter rows to default state
                const filterRows = advancedFilters.querySelectorAll('.filter-row');
                filterRows.forEach((row, index) => {
                    if (index === 0) {
                        // Reset first row to default values
                        row.querySelector('.field-select').value = '';
                        row.querySelector('.operator-select').value = 'equals';
                        row.querySelector('.value-input').value = '';
                        row.querySelector('.logic-select').value = 'AND';
                    } else {
                        // Remove additional rows
                        row.remove();
                    }
                });
                
                // Hide advanced filters section
                advancedFilters.classList.remove('show');
                const toggleButton = document.querySelector('.toggle-advanced');
                if (toggleButton) {
                    toggleButton.setAttribute('aria-expanded', 'false');
                }
            }
            
            // Apply filters to update the table
            applyFilters();
        }
    </script>
{% endblock %}
